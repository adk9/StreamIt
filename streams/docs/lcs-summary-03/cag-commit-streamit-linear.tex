% Name your report <group>-<unique-name>.tex, (e.g., sls-jupiter.tex)
% to avoid name collisions.  For \label{} entries within a file,
% please use \<group>-<unique-name>-<your label} (e.g.,
% \label{sls-jupiter-figure}), again to avoid name collisions.  There
% is no need to use unique names with \cite{} since each report has
% its own citation namespace.

% You can also use \formattitle{Title}{Authors} to gain formatting
% control (e.g., footnotes on author names or controlling line breaks
% with \\) and \formatcontents{Title}{Authors}.  Since we did not need
% such control, we simply used \formattitlecontents{Title}{Authors}
% here.  Please do not put any special formatting in
% \formattitlecontents or \formatcontents as this will disturb the
% table of contents.

\formattitlecontents 
{Linear Analysis and Optimization of Stream Programs}
{Andrew Lamb, Bill Thies, Saman Amarasinghe}


% Please use the following \formatsection entries unless they are
% inappropriate: Introduction, Approach, Progress, Future, Research
% Support.
%
% Do not put a blank line after a \formatsection, as this affects the
% formatting.

\formatsection{Introduction}
More than fifty percent of the code that runs the Digital Signal Processors
(DSPs) in a modern cell phone is written in assembly language and the 
rest is written in annotated C\cite{gass-talk}. Clearly even the best 
compilers that DSP companies can produce are utterly failing to produce
the optimizion necessary for programs that will run the next generation
of signal processors.

The sheer volume of analysis required to make optimal use of the special 
purpose instructions in DSPs leaves compilers for standard languages such 
as C unable to perform most of the simplest optimizations taught to electrical 
engineering students. Using StreamIt~\cite{streamitcc}, 
a domain-specific stream processing language, we have been exploring
high-level automatic DSP optimizations that are generally intractable 
for a general-purpose language.

\formatsection{Approach}
Our analysis and optimizations focus on filters which compute {\it linear} 
functions of their inputs. A filter computes a linear function if
the computation it does can be described by a vector-matrix operation. 
Many fundamental DSP operations such as filtering, the Discrete Fourier 
Transform (DFT), up sampling and downsampling, can be described 
with vector-matrix operations. The foundation of this project is built on
a simple dataflow algorithm that can determine which filters in a 
StreamIt program perform linear computations and the specific matrices
which describe that computation.

\begin{figure}
  \center
  \begin{tabular}{cc}
    \begin{minipage}{2.3in}
      \includegraphics[height=1.5in]{cag-commit-streamit-linear-expand.eps} \\
      \noindent
      {\bf (a) Expanding rates to $(e', o', u')$.}
    \end{minipage} &
    \begin{minipage}{3.5in}
      \includegraphics[height=1.5in]{cag-commit-streamit-linear-sjcombo.eps} \\
      \noindent
      {\bf (b) Combining a SplitJoin of linear sub streams.}
    \end{minipage} \\
  \end{tabular}
  \caption{Graphical depictions of linear combination algorithms.}
  \label{fig:cag-commit-streamit-linear-combo}
  \vspace{-12pt}
\end{figure}

A primary benefit of linear filter analysis is that neighboring
filters can be collapsed into a single matrix representation if both
of the filters are linear. Transformations such as this automatically
eliminate redundant computations in linear sections of the stream
graph. This automation allows programmers to write simple, modular 
filters and leave complex combination and optimizations to the compiler.
We have developed algorithms for a {\it linear expansion} operation 
(Figure~\ref{fig:cag-commit-streamit-linear-combo} (a)), and for collapsing 
{\tt pipeline}s and {\tt splitjoin}s into overall linear nodes
(Figure~\ref{fig:cag-commit-streamit-linear-combo} (b)).

To take advantage of the linear analysis framework, our compiler
has two linear analysis optimizations. The first, {\it linear replacement},
replaces the largest possible linear sections of the program with filters
that directly compute the corresponding vector-matrix product. 
The second optimization, {\it frequency replacement}, replaces streams 
which implement digital filtering using a standard conversion to the 
frequency domain.

\formatsection{Progress}
We have developed a fully automatic implementation of the linear analysis 
and optimizations as passes in the StreamIt compiler. Our preliminary results
are very promising. In our suite of benchmark applications, our optimizations
increased execution speed by an average factor of five, $6.5$ in the best 
case. Figure~\ref{fig:cag-commit-streamit-linear-speedup} (a) shows
the execution time increase for our benchmarks. 
Both optimizations significantly reduce the amount of computation required
for each benchmarks, which is reflected by a reduction in the number of floating 
point multiplications (Figure~\ref{fig:cag-commit-streamit-linear-speedup} (right)).

\begin{figure}
  \center
  \begin{tabular}{cc}
    \begin{minipage}{3.0in}
      \includegraphics[height=2in]{cag-commit-streamit-linear-speedup.eps} \\
      \noindent {\bf (a) Execution speedup for each of the benchmarks with both linear 
	replacement and frequency replacement optimizations.}
    \end{minipage} &
    \begin{minipage}{3.0in}
      \includegraphics[height=2in]{cag-commit-streamit-linear-mults.eps} \\
      \noindent {\bf (b) Percent of multiplication operations remaining after performing 
	linear replacement, frequency replacement, and both.}
    \end{minipage}
  \end{tabular}
  \caption{Benchmark performance for linear optimizations.}
  \label{fig:cag-commit-streamit-linear-speedup}
\vspace{-12pt}
\end{figure}

To determine if our automatic optimization could fully realize the maximum 
theoretical savings possible using the frequency
replacement optimization, we measured multiplication reduction as a function
of both filter size and FFT size. The results predicted by theory are shown in
Figure~\ref{fig:cag-commit-streamit-linear-freq} (a) and the results that
we measured are shown in Figure~\ref{fig:cag-commit-streamit-linear-freq} (b).

\formatsection{Future}
For future research, we are developing new optimizations which make use
of our linear analysis framework. For instance, we are investigating saving
redundant partial results between filter executions. 

We are considering expanding our framework to capture
more information about linear computations. Recognizing state variables 
that are linear combinations of the input and previous state would 
allow us to analyze wider range of programs such as adaptive filters 
and in control applications.
Another way to extend the framework is to add support for symbolic array entries.
Symbolic entries would allow us to use out current optimizations with
programs that are updated rarely within the program's execution.

Finally, we are planning on using the linearity information our
analysis extracts to make more informed decisions in other parts of the compiler.
For instance,  the StreamIt compiler is going to be extended to target 
a DSP architecture and we can make use of the linear information to 
take advantage of the specialized instructions that DSPs offer.

\begin{figure}
  \center
  \begin{tabular}{cc}
    \begin{minipage}{3.0in}
      {\center \includegraphics[height=2in]{cag-commit-streamit-linear-freq-theory.eps}} \\
      \noindent {\bf (a) Theoretical multiplication reduction.}
    \end{minipage} &
    \begin{minipage}{3.0in}
      {\center \includegraphics[height=2in]{cag-commit-streamit-linear-freq-measure.eps}} \\
      \noindent {\bf (b) Measured multiplication reduction.}
    \end{minipage}
  \end{tabular}
  \caption{Theoretical vs. Empirical multiplication reduction.}
  \label{fig:cag-commit-streamit-linear-freq}
  \vspace{-12pt}
\end{figure}



\formatsection{Research Support}
From DARPA and the Oxygen alliance (I don't know the details.....XXXXXXXXXXXXXXXXXXXX)
% Although the use of BibTeX is highly recommended, you can manually
% format your references as follows:
%
% \begin{thebibliography}{1}
%
% \bibitem{Zue00}
% V.~Zue, S.~Seneff, J.~R. Glass, J.~Polifroni, C.~Pao, T.~J. Hazen, and
% L.~Hetherington, ``\textsc{Jupiter}: A telephone-based conversational
% interface for weather information,'' \textit{IEEE Transactions on
% Speech and Audio Processing}, vol. 8, no.  1, pp. 85--96, Jan. 2000.
% 
% \end{thebibliography}

\bibtex{cag-commit-streamit-linear}
