\begin{figure}[t]
\framebox[6.5in]{
\begin{minipage}{6.3in}
\begin{center}
{\bf Helper Functions}
\end{center}
\begin{itemize}
\item The number of integral points in a one-dimensional domain ${\cal
D}$ is denoted by $|{\cal D}|$.  The sign and absolute value of an
integer $i$ are given by $sign(i)$ and $abs(i)$, respectively.
%
\item $\mt{PartialWrite}(c,t,p) = \sum_{r=0}^{p-1} U(c, t, r)$
%
\item $\mt{TotalWrite}(n,c,t) = \sum_{r=0}^{\mt{num}(n, t)-1} U(c, t, r)$
%
\item $\mt{PartialRead}(c,t,p) = \sum_{r=0}^{p-1} O(c, t, r)$
%
\item $\mt{TotalRead}(n,c,t) =  \sum_{r=0}^{\mt{num}(n, t)-1} O(c, t, r)$
%
\item Given channel $c = (n_a, n_b)$:
\begin{align*}
\mt{Period}(c) \equiv S(n_a) * \mt{TotalWrite}(n_a, c, \mt{steady}) = 
S(n_b) * \mt{TotalRead}(n_b, c, \mt{steady})
\end{align*}
%
\end{itemize}
%
\end{minipage}}
\caption{Helper functions for the PCG to SARE translation.
\protect\label{fig:helper}}
\end{figure}

\begin{figure}[t]
\framebox[6.5in]{
\begin{minipage}{6.3in}
\begin{center}
{\bf Variables}
\end{center}

For each channel $c = (n_a, n_b)$, do the following:
\begin{itemize}

\item Introduce variables $\mt{IBUF}_c$ and $\mt{SBUF}_c$ with the following domains:
\begin{align}
{\cal D}_{{IBUF}_c} = \{~i~|~0 \le i \le A(c) +
\sum_{p=0}^{\mt{num}(n_a, \mt{init})-1} U(c, \mt{init}, p) - 1 \} \\ \nonumber ~ \\
%
{\cal D}_{{SBUF}_c} = \{ ~(i,j)~|~0 \le i \le N - 1 ~\wedge~ 0 \le j \le \mt{Period}(c) - 1\}
\end{align}

\item For each $p \in [0, num(n_a, \mt{init})-1]$, introduce
variable $\mt{IWRITE}_{c, p}$ with this domain:
\begin{align}
{\cal D}_{{IWRITE}_{c, p}} = \{~i~|~0 \le i \le U(c, \mt{init}, p) - 1\}
\end{align}

\item For each $p \in [0, num(n_b, \mt{init})-1]$, introduce
variable $\mt{IREAD}_{c, p}$ with this domain:
\begin{align}
{\cal D}_{{IREAD}_{c, p}} = \{~i~|~0 \le i \le E(c, \mt{init}, p) - 1\}
\end{align}
%
\item For each $p \in [0, num(n_a, \mt{steady})-1]$, introduce
variable $\mt{SWRITE}_{c, p}$ with this domain:
\begin{align}
{\cal D}_{{SWRITE}_{c, p}} = \{~(i,j,k)~|~0 \le i \le N-1 ~\wedge~ 0 \le j \le S(n_a) - 1 ~\wedge~ 0 \le k \le U(c, \mt{steady}, p) - 1\}
\end{align}
%
\item For each $p \in [0, num(n_b, \mt{steady})-1]$, introduce
variable $\mt{SREAD}_{c, p}$ with this domain:
\begin{align}
{\cal D}_{{SREAD}_{c, p}} = \{~(i,j,k)~|~0 \le i \le N-1 ~\wedge~ 0 \le j \le S(n_b) - 1 ~\wedge~ 0 \le k \le E(c, \mt{steady}, p) - 1\}
\end{align}
%
\end{itemize}
%
\end{minipage}}
\caption{Variables for the PCG to SARE translation.
\protect\label{fig:pcgtosare1}}
\end{figure}

\begin{figure}[t]
\framebox[6.5in]{
\begin{minipage}{6.3in}
\begin{center}
{\bf Equations (Part 1)}
\end{center}
\noindent For each channel $c = (n_a, n_b)$, do the following:
\begin{itemize}
%
\item Introduce this equation (I to IBUF):
\begin{align}
\forall i \in [0,A(c)-1],~\mt{IBUF}_{c}(i) = I(c)[i]
\end{align}

\item For each $p \in [0, num(n_a, \mt{init})-1]$, introduce this
equation (IWRITE to IBUF):
\begin{align}
&\forall i \in [A(c) + \mt{PartialWrite}(c,\mt{init},p), 
               A(c) + \mt{PartialWrite}(c,\mt{init},p+1)-1], \\ \nonumber
&\mt{IBUF}_{c}(i) = \mt{IWRITE}_{c, p}(i - A(c) - \mt{PartialWrite}(c,\mt{init},p))
\end{align}
%
\item For each $c \in \mt{chan\_out}(n)$, and for each $p \in [0,
num(n, \mt{init})-1]$, introduce this equation (IREAD to IWRITE):
%
\begin{align}
&\forall i \in {\cal D}_{{IWRITE}_{c, p}},~\mt{IWRITE}_{c,p}(i) = W(n, \mt{init}, p)(\mt{Init\_Inputs})[\mt{pos\_out}(n, c)][i] \\ \nonumber
&\mt{where Init\_Inputs} = [\mt{IREAD}_{{chan\_in}(n)[1], p}(*), \dots, \mt{IREAD}_{{chan\_in}(n)[\mt{num\_in}(n)], p}(*) ]
\end{align}
%
\item For each $c \in \mt{chan\_out}(n)$, and for each $p \in [0,
num(n, \mt{steady})-1]$, introduce this equation (SREAD to SWRITE):
%
\begin{align}
&\forall (i, j, k) \in {\cal D}_{{SWRITE}_{c, p}},~\mt{SWRITE}_{c,p}(i,j,k) =\\\nonumber
&W(n, \mt{steady}, p)(\mt{Steady\_Inputs})[\mt{pos\_out}(n, c)][j], \mt{where}\\\nonumber
&\mt{Steady\_Inputs} = [\mt{SREAD}_{{chan\_in}(n)[1], p}(i, j, *), \dots, \mt{SREAD}_{{chan\_in}(n)[\mt{num\_in}(n)], p}(i, j, *) ]
\end{align}
%
\item For each $c \in \mt{chan\_out}(n)$, for each $p \in [0,
\mt{num}(n, \mt{steady})-1]$, and for each $q \in
[0,\frac{\mt{Period(c)}}{\mt{TotalWrite(n,c,\mt{steady})}}-\mt{1}]$,
introduce this equation (SWRITE to SBUF):
\begin{align}
&\forall (i,j) \in {\cal D}_{SW {\small \rightarrow} SB}(c,p,q),
\mt{SBUF}_{c}(i,j) = \\
&  \mt{SWRITE}_{c, p}(i * \frac{\mt{Period}(c)}{\mt{TotalWrite}(n,c,\mt{steady})} + 
                       \lfloor \frac{q}{S(n)} \rfloor, 
                     q~mod~S(n),
                     j - \mt{Offset}_{SW {\small \rightarrow} SB}(q,n,c,p)),
\mt{where } \nonumber\\&{\cal D}_{SW {\small \rightarrow} SB}(c,p,q) = 
  {\cal D}_{{SBUF}_{c}} \cap 
  \{ (i,j) | \mt{Offset}_{SW {\small \rightarrow} SB}(q,n,c,p) \le j
             \le \mt{Offset}_{SW {\small \rightarrow} SB}(q,n,c,p+1) - 1 \} \nonumber\\\nonumber
&\mt{and } \mt{Offset}_{SW {\small \rightarrow} SB}(q,n,c,p') = q*\mt{TotalWrite}(n,c,\mt{steady}) + \mt{PartialWrite}(c,\mt{steady},p'))
\end{align}
%
\item For each $c \in \mt{chan\_in}(n)$, and for each phase $p \in
[0, \mt{num}(n, \mt{init})-1]$, introduce this equation (IBUF to IREAD):
\begin{align}
&\forall i \in {\cal D}_{IB {\small \rightarrow} IR}(c,p), 
\mt{IREAD}_{c, p}(i) = \mt{IBUF}_{c}(\mt{PartialRead}(c, \mt{init}, p) + i) \\ \nonumber
&\mt{and }{\cal D}_{IB {\small \rightarrow} IR}(c,p) = 
  \{ i | i \in {\cal D}_{{IREAD}_{c,p}} ~\wedge~ 
         i + \mt{PartialRead}(c, \mt{init}, p) \in {\cal D}_{{IBUF}_{c}} \}
\end{align}
%
\end{itemize}
\end{minipage}}
\caption{Equations for the PCG to SARE translation.
\protect\label{fig:pcgtosare2}}
\end{figure}

\begin{figure}[t]
\framebox[6.5in]{
\begin{minipage}{6.3in}
\begin{center}
{\bf Equations (Part 2)}
\end{center}
\noindent For each node $n$, do the following:
\begin{itemize}
\item For each $c \in \mt{chan\_in}(n)$, for each phase $p \in [0,
\mt{num}(n, \mt{init})-1]$, and for \\ each $q \in [0, \lfloor
\frac{\mt{argmax}_{\mt{p}'} \left( \mt{PartialRead}(\mt{c}, \mt{init},
\mt{p}') + \mt{E}(\mt{c}, \mt{init}, \mt{p}') \right)
}{\mt{Period(c)}} \rfloor ]$, introduce this equation (SBUF to
IREAD):
\begin{align}
&\forall i \in {\cal D}_{SB {\small \rightarrow} IR}(c,p), 
\mt{IREAD}_{c,p}(i) = 
    \mt{SBUF}_{c}(q,
      i - \mt{Offset}_{SB {\small \rightarrow} IR}(q,n,c,p)), \mt{where } \\ \nonumber
&{\cal D}_{SB {\small \rightarrow} IR}(c,p) = 
  \{ i | i \in {\cal D}_{{IREAD}_{c,p}} ~\wedge~
         \mt{Offset}_{SB {\small \rightarrow} IR}(q,n,c,p)
         \le i \le
         \mt{Offset}_{SB {\small \rightarrow} IR}(q+1,n,c,p) - 1 \} \\ \nonumber
&\mt{and }\mt{Offset}_{SB {\small \rightarrow} IR}(q',n,c,p) = 
  q' * \mt{Period}(c) + |{\cal D}_{{IBUF}_c}| - \mt{PartialRead}(c,\mt{init},p)
\end{align}
%
\item For each $c \in \mt{chan\_in}(n)$, and for each phase $p \in [0,
\mt{num}(n, \mt{steady})-1]$, introduce this equation (IBUF to
SREAD):
\begin{align}
\forall (i,j,k) \in {\cal D}_{IB {\small \rightarrow} SR}(n,c,p), 
\mt{SREAD}_{c, p}(i,j,k) = 
    \mt{IBUF}_{c}(\mt{ReadIndex}(n,c,p,i,j,k)), \mt{where} \\ \nonumber
\mt{ReadIndex}(n,c,p,i,j,k) = \mt{TotalRead}(n,c,\mt{init})
                + (i*S(n)+j)*\mt{TotalRead}(n,c,\mt{steady}) \\ \nonumber
                &+ \mt{PartialRead}(c, \mt{steady}, p) 
                + k) \\\nonumber
\mt{and }{\cal D}_{IB {\small \rightarrow} SR}(n,c,p) = 
  \{ (i,j,k) | \mt{ReadIndex}(n,c,p,i,j,k) \in {\cal D}_{{IBUF}_{c}} \}
\end{align}
%
\item For each $c \in \mt{chan\_in}(n)$, for each phase $p \in [0,
\mt{num}(n, \mt{steady})-1]$, and for each $q \in [0, \lfloor
\frac{\mt{E(c, steady, p)}}{\mt{Period(c)}} \rfloor]$, introduce
these equations (SBUF to SREAD):
% two possible problems: sread has already been written to, or sbuf has already been read from
\begin{align}
\forall (i,j,k) \in {{\cal D}\mt{1}}_{SB {\small \rightarrow} SR}(c,p,q),\\ \nonumber
\mt{SREAD}_{c, p}(i,j,k) = 
    \mt{SBUF}_{c}(i+q+
                  \mt{Int\_Offset}(n,c,p),\\ \nonumber
                  j*\mt{TotalRead}(n,c,\mt{steady}) + 
                    \mt{PartialRead}(c,\mt{steady},p) + k
                   - q * \mt{Period}(c) + \mt{Mod\_Offset}(n,c,p)) \\ \nonumber
\mt{where }{{\cal D}\mt{1}}_{SB {\small \rightarrow} SR}(c,p,q) = 
  ({\cal D}_{{SREAD}_{c, p}} - \mt{PUSHED}(n,c,p)) \\
                         \cap \{ (i,j,k) | q * \mt{Period}(c) - min(0, \mt{Mod\_Offset}(n,c,p))
                                \le k 
                                \le min((q+1)*\mt{Period}(c),  \\ \nonumber
                                        E(c, \mt{steady}, p)) - 1 
                                        - max(0, \mt{Mod\_Offset}(n,c,p)) \} \\ \nonumber &~
%
%
\forall (i,j,k) \in {{\cal D}\mt{2}}_{SB {\small \rightarrow} SR}(c,p,q), \\
\mt{SREAD}_{c, p}(i,j,k) = 
    \mt{SBUF}_{c}(i+q+
                  \mt{sign(Offset)} + \mt{Int\_Offset}(n,c,p), \\ \nonumber
                  j*\mt{TotalRead}(n,c,\mt{steady}) + 
                    \mt{PartialRead}(c,\mt{steady},p) + k  \\ \nonumber
                   - q * \mt{Period}(c) 
                   - \mt{sign(Offset)} * \mt{Period}(c) + \mt{Mod\_Offset}(n,c,p)) \\ \nonumber
\mt{where }{{\cal D}\mt{2}}_{SB {\small \rightarrow} SR}(c,p,q) = 
  ({\cal D}_{{SREAD}_{c, p}} - \mt{PUSHED}(n,c,p)) \\ \nonumber
                         \cap ( \{ (i,j,k) | q * \mt{Period}(c)
                                      \le k 
                                      \le min((q+1)*\mt{Period}(c),  \\ \nonumber
                                              E(c, \mt{steady}, p)) - 1 \} - {{\cal D}\mt{1}}_{SB {\small \rightarrow} SR}(c,p,q) ) \\ \nonumber &~ \\ \nonumber
%
%
\mt{where }\mt{PUSHED}(n,c,p) = {\cal D}_{IB {\small \rightarrow} SR}(n,c,p) \\ \nonumber
\mt{and }\mt{Num\_Pushed}(n,c,p) = 
% this is a dot product of (i,j,k) with something
  (max_{\preceq}\mt{PUSHED}(n,c,p)) \cdot (S(n) * \mt{TotalRead}(n,c,\mt{steady}), \\ \nonumber
                                        \mt{TotalRead}(n,c,\mt{steady}), \\ \nonumber
                                        1 ) + \mt{PartialRead}(c, \mt{steady}, p) \\ \nonumber
\mt{and }\mt{PEEKED}(c,p) = {SB {\small \rightarrow} IR}(c,p) \\ \nonumber
\mt{and }\mt{Num\_Popped}(c,p) = |\mt{PEEKED}(c,p)| - (E(c,\mt{steady},p) - O(c,\mt{steady},p)) \\ \nonumber
\mt{and }\mt{Offset}(n,c,p) = \mt{Num\_Popped}(c,p)-\mt{Num\_Pushed}(n,c,p) \\ \nonumber
\mt{and }\mt{Int\_Offset}(n,c,p) = \mt{sign(Offset)}*\lfloor \frac{abs(\mt{Offset}(n,c,p))}{\mt{Period}(c)} \rfloor) \\ \nonumber
\mt{and }\mt{Mod\_Offset}(n,c,p) = \mt{sign(Offset)}*(abs(\mt{Offset}(n,c,p))~\mt{mod}~\mt{Period}(c)) \\ \nonumber
%
\end{align}
%
\end{itemize}
\end{minipage}}
\caption{Equations for the PCG to SARE translation.
\protect\label{fig:pcgtosare3}}
\end{figure}

