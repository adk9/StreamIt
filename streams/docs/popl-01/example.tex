\begin{figure*}
\centering
\psfig{figure=Radio.eps,width=5.2in}
\caption{ fig1}
\label{fig:data_structs}
\end{figure*}

\begin{figure}
\centering
\psfig{figure=fft-block.eps,width=3.2in}
\caption{ fig1}
\label{fig:data_structs}
\end{figure}

\begin{figure*}
\centering
\psfig{figure=fft-pre-tape.eps,width=4.8in}
\caption{ fig1}
\label{fig:data_structs}
\end{figure*}

\begin{figure*}
\centering
\psfig{figure=fft-butterfly-tape.eps,width=5.8in}
\caption{ fig1}
\label{fig:data_structs}
\end{figure*}

\begin{figure}
\centering
\psfig{figure=fir-block.eps,width=3.2in}
\caption{ fig1}
\label{fig:data_structs}
\end{figure}

\begin{figure*}
\centering
\psfig{figure=fir-tape.eps,width=5.2in}
\caption{ fig1}
\label{fig:data_structs}
\end{figure*}


\newpage

\begin{figure}[t]
\scriptsize
\begin{verbatim}

class Butterfly extends Stream {
   void init(int N, int W) {
      add(new SplitJoin() {
         void init() {
            weighted_round_robin(N, N);
            add (new Identity());
            add (new Filter() {
               Complex weights[W];
               int curr;
               Channel input = new ComplexChannel();
               Channel output = new ComplexChannel();
               void init() {
                  for(int i=0; i<W; i++)
                     weights[i] = calc_weight(i, N, W);
                  curr = 0;
               }
               void work() {
                  output.push(input.pop()*weights[curr++]);
                  if(curr>= W) curr = 0;
               }    
            })
            round_robin();
      }});
      add(new SplitJoin() {
         void init() {
            duplicate();
            add (new Filter() {   
               Channel input = new ComplexChannel();
               Channel output = new ComplexChannel();
               void work() {
                  putput.push(input.pop() + input.pop());
               }
            })
            add (new Filter() {   
               Channel input = new ComplexChannel();
               Channel output = new ComplexChannel();
               void work() {
                  putput.push(input.pop() - input.pop());
               }
            })
            weighted_round_robin(N, N);
      }});
   }
}

class FFT extends Stream {
   void init(int N) {
      add(new SplitJoin() {
         void init() {
            weighted_round_robin(N/2, N/2);
            for(int i=0; i<2; i++) 
               add(new SplitJoin() {
                  void init() {
                     round_robin();
                     add (new Identity());
                     add (new Identity());
                     weighted_round_robin(N/4, N/4);
               }});
            round_robin();
      }});
      for(int i=2; i<=N/2; i *= 2)
        add(new Butterfly(i, N));
   }
}

class FIR extends Stream {
   void init(int N) {
      add(new SplitJoin() {
         void init() {
            duplicate();
            for(int i=0; i<N; i++)
               add(new Filter() {
                  Channel input = new ComplexChannel();
                  Channel output = new ComplexChannel();           
		  Complex h;
                  void init() {
                     h = calc_fir_coeff(i, N);
                     for(int j=0; j<i; j++) 
                        output.push(0);
                  }
                  void work() {
                     output.push(input.pop()*h);
                  }
               })
            round_robin();
         }
      })
      add(new Filter() { 
         Channel input = new ComplexChannel();
         Channel output = new ComplexChannel();
         void work() {
	    Complex val = 0;
            for(int i=0; i<N; i++)
               val += input.pop();
            output.push(val);
         }
      })
   }
}

\end{verbatim}
\vspace{-12pt}
\caption{\protect\small Example stuff.
\protect\label{fig1}}
\vspace{-12pt}
\end{figure}

\begin{figure}[t]
\scriptsize
\begin{verbatim}

class RFtoIF extends Filter {
   Channel input = new ComplexChannel();
   Channel output = new ComplexChannel();
   int sz;
   int i;
   Complex weight[];
   void init(double f) {
      i = 0;
      sz = CarrierFreq/f*N;
      weight = new Complex[sz];
      for(int i=0; i<sz; i++)
         weight[i] = sine(i*pi/sz);
   }
   void work() {
      output.push(input.pop()*weight[i++]);
      if(i==sz) i = 0;
   }
}


class CheckFreqHop extends Stream {
   void init() {
      add(new SplitJoin() {
         void init() {
            weighted_round_robin(N/4-2,1,1,N/2,1,1,N/4-2);
	    int k = 0;
            for(int i=0; i<4; i++) {
               if((i==0)||(i==2)) {
                  for(int j=0; j<2; j++) {
                     add(new Filter() {
                        Channel input = new ComplexChannel();
                        Channel output = new ComplexChannel();
		        void work() {
                           Complex val = input.pop();
                           if(val >= MIN_TRASHOLD)
                              send init(Freq[k])
                           output.push(val);
                        }
                     });
                     k++;
		  }
               } else
                  add(new Identity());
            }
            weighted_round_robin(N/4-2,1,1,N/2,1,1,N/4-2);
         }
   })
}

class CheckQuality extends Filter {
   Channel input = new ComplexChannel();
   Channel output = new ComplexChannel();
   Complex ave_hi, ave_lo;   
   void init() {
      ave_hi = 0;
      ave_lo = 0;
   }
   void work() {
      Complex val;
      val = input.pop();
      ave_hi = max(0.9*ave_hi, val);
      ave_lo = min(0.9*ave_lo, val);
      if(ave_hi - ave_lo < QUAL_BAD_TRASHOLD)
         send over(True);
      if(ave_hi - ave_lo > QUAL_GOOD_TRASHOLD)
         send over(False);
   }
}

class IncreaseSignalStrength extends Stream {
   void init(boolean adds) {
      if(adds) add(new FIR(N));
   }
}

class Radio extends Stream {
   void init() {
      add(new ReadFromAtoD());
      add(new RFtoIF(Freq[0]));
      add(new IncreaseSignalStrength());
      add(new FFT());
      add(new CheckFreqHop());
      add(new CheckQuality());
      add(new AudioBackEnd());
   }
}

\end{verbatim}
\vspace{-12pt}
\caption{\protect\small Example stuff.
\protect\label{fig1}}
\vspace{-12pt}
\end{figure}
